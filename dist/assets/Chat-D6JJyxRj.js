import{j as e,u as B,c as ne,d as re,r as n,e as P,_ as A,f as _,h as oe,l as ae,i as ie,k as ce,m as le,n as de,o as me,C as ue,p as ge,q as pe,t as fe,S as z,g as he,T as xe,I as je,v as ye,w as N,x as D,N as O,A as ve}from"./index-Du6Uwkmi.js";import{A as Me}from"./AppLayout-DVFKwbfS.js";import{M as Se,a as Ce}from"./Menu-wUt2zOYa.js";import{M as T,L as k}from"./MenuItem-CblBUfRF.js";import{c as S,T as V}from"./Typography-D1miUXsC.js";import{R as be}from"./RenderAttachment-CHzExpBj.js";import{m as Ae,u as Le,a as Te}from"./Hook-v4cjVH3m.js";import{B as ke}from"./Menu-D39zixRf.js";import{b as Ee}from"./index-DJ2Ah1Ch.js";import{I as $}from"./Modal-DdgoaOgr.js";import"./Toolbar-GU60VVgH.js";import"./Notifications-DkBQbnSo.js";import"./Tooltip-Cct72D16.js";import"./AvatarCard-DzGKErVP.js";import"./ExitToApp-DHmyjwa3.js";const Fe=S(e.jsx("path",{d:"M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6z"}),"AttachFile"),Ve=S(e.jsx("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8zm2 11h-3v3.75c0 1.24-1.01 2.25-2.25 2.25S8.5 17.99 8.5 16.75s1.01-2.25 2.25-2.25c.46 0 .89.14 1.25.38V11h4zm-3-4V3.5L18.5 9z"}),"AudioFile"),Ie=S(e.jsx("path",{d:"M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2M8.5 13.5l2.5 3.01L14.5 12l4.5 6H5z"}),"Image"),we=S(e.jsx("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send"),Re=S(e.jsx("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8zm4 18H6V4h7v5h5zM8 15.01l1.41 1.41L11 14.84V19h2v-4.16l1.59 1.59L16 15.01 12.01 11z"}),"UploadFile"),He=S(e.jsx("path",{d:"M14 2H6.01c-1.1 0-2 .89-2 2L4 20c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8zm-1 7V3.5L18.5 9zm1 5 2-1.06v4.12L14 16v1c0 .55-.45 1-1 1H9c-.55 0-1-.45-1-1v-4c0-.55.45-1 1-1h4c.55 0 1 .45 1 1z"}),"VideoFile");function _e({anchorE1:t,chatId:c}){const a=B(),{isFileMenu:h}=ne(s=>s.misc),o=()=>a(P(!1)),[x]=re(),i=n.useRef(null),u=n.useRef(null),g=n.useRef(null),p=n.useRef(null),l=()=>{var s;return(s=i.current)==null?void 0:s.click()},j=()=>{var s;return(s=u.current)==null?void 0:s.click()},L=()=>{var s;return(s=g.current)==null?void 0:s.click()},E=()=>{var s;return(s=p.current)==null?void 0:s.click()},y=async(s,f)=>{const C=Array.from(s.target.files);if(C.length<=0)return;if(C.length>5)return A.error(`You can only send 5 ${f} at a time`);a(_(!0));const v=A.loading(`Sending ${f}...`);o();try{const d=new FormData;d.append("chatId",c),C.forEach(M=>d.append("files",M)),(await x(d)).data?A.success(`${f} sent successfully`,{id:v}):A.error(`Failed to send ${f}`,{id:v})}catch(d){A.error(d,{id:v})}finally{a(_(!1))}};return e.jsx(Se,{anchorEl:t,open:h,onClose:o,children:e.jsx("div",{style:{width:"10rem"},children:e.jsxs(Ce,{children:[e.jsxs(T,{onClick:l,children:[e.jsx(Ie,{}),e.jsx(k,{style:{marginLeft:"0.5rem"},children:"Image"}),e.jsx("input",{type:"file",multiple:!0,accept:"image/png, image/jpeg, image/gif",style:{display:"none"},onChange:s=>y(s,"Images"),ref:i})]}),e.jsxs(T,{onClick:j,children:[e.jsx(Ve,{}),e.jsx(k,{style:{marginLeft:"0.5rem"},children:"Audio"}),e.jsx("input",{type:"file",multiple:!0,accept:"audio/mpeg, audio/wav",style:{display:"none"},onChange:s=>y(s,"Audios"),ref:u})]}),e.jsxs(T,{onClick:L,children:[e.jsx(He,{}),e.jsx(k,{style:{marginLeft:"0.5rem"},children:"Video"}),e.jsx("input",{type:"file",multiple:!0,accept:"video/mp4, video/webm, video/ogg",style:{display:"none"},onChange:s=>y(s,"Videos"),ref:g})]}),e.jsxs(T,{onClick:E,children:[e.jsx(Re,{}),e.jsx(k,{style:{marginLeft:"0.5rem"},children:"File"}),e.jsx("input",{type:"file",multiple:!0,accept:"*",style:{display:"none"},onChange:s=>y(s,"Files"),ref:p})]})]})})})}const ze=({message:t,user:c})=>{const{sender:a,content:h,attachments:o=[],createdAt:x}=t,i=String(a==null?void 0:a._id)===String(c==null?void 0:c._id),u=oe(x).fromNow();return e.jsxs(Ae.div,{initial:{opacity:0,x:"-100%"},whileInView:{opacity:1,x:0},style:{alignSelf:i?"flex-end":"flex-start",backgroundColor:i?"#dcf8c6":"#fff",color:i?"black":"#333333",borderRadius:"5px",padding:"0.5rem",width:"fit-content"},children:[!i&&e.jsx(V,{color:ae,fontWeight:"600",variant:"caption",children:a.name}),h&&e.jsx(V,{children:h}),o.length>0&&o.map((g,p)=>{const l=g.url,j=ie(l);return e.jsx(ke,{children:e.jsx("a",{href:l,target:"_blank",download:!0,style:{color:"black"},children:be(j,l)})},p)}),e.jsx(V,{variant:"caption",color:"text.secondary",children:u})]})},Ne=n.memo(ze);function De({chatId:t,user:c}){var I,w,R,H;const a=B(),h=ce(),o=le(),x=n.useRef(null),i=n.useRef(null),[u,g]=n.useState(""),[p,l]=n.useState([]),[j,L]=n.useState(1),[E,y]=n.useState(null),[s,f]=n.useState(!1),[C,v]=n.useState(!1),d=n.useRef(null),m=de({chatId:t,skip:!t}),M=me({chatId:t,page:j}),b=(w=(I=m==null?void 0:m.data)==null?void 0:I.chat)==null?void 0:w.members,G=[{isError:m.isError,error:m.error},{isError:M.isError,error:M.error}],{data:U,setData:Y}=Ee(x,(R=M.data)==null?void 0:R.totalPages,j,L,(H=M.data)==null?void 0:H.messages),W=r=>{a(P(!0)),y(r.currentTarget)};n.useEffect(()=>{i.current&&i.current.scrollIntoView({behavior:"smooth"})},[p]);const Q=r=>{g(r.target.value),s||(o.emit(N,{members:b,chatId:t}),f(!0)),d.current&&clearTimeout(d.current),d.current=setTimeout(()=>{o.emit(D,{members:b,chatId:t}),f(!1)},[1100])},q=r=>{r.preventDefault(),u.trim()&&(o.emit(O,{chatId:t,members:b,message:u}),g(""))};n.useEffect(()=>(o.emit(ue,{userId:c._id,members:b}),a(ge(t)),()=>{g(""),l([]),Y([]),L(1),o.emit(pe,{userId:c._id,members:b})}),[t]),n.useEffect(()=>{if(m.isError)return h("/")},[m.isError]);const J=n.useCallback(r=>{r.chatId===t&&l(F=>[...F,r.message])},[t]),X=n.useCallback(r=>{r.chatId===t&&v(!0)},[t]),K=n.useCallback(r=>{r.chatId===t&&v(!1)},[t]),Z=n.useCallback(r=>{if(r.chatId!==t)return;const F={content:e.jsxs("span",{children:[e.jsx("span",{style:{fontWeight:"bold"},children:r.message})," ",r.flag==="removed"?"has been removed from the group":"",r.flag==="added"?"has been added in the group":""]}),sender:{_id:"djasdhajksdhasdsadasdas",name:"Admin"},chat:t,createdAt:new Date().toISOString()};l(te=>[...te,F])},[t]),ee={[ve]:Z,[O]:J,[N]:X,[D]:K};Le(o,ee),Te(G);const se=[...U,...p];return m.isLoading?e.jsx(fe,{}):e.jsxs(e.Fragment,{children:[e.jsxs(z,{ref:x,boxSizing:"border-box",padding:"1rem",spacing:"1rem",height:"90%",sx:{bgcolor:he,overflowX:"hidden",overflowY:"auto"},children:[se.map(r=>e.jsx(Ne,{message:r,user:c},r._id)),C&&e.jsx(xe,{}),e.jsx("div",{ref:i})]}),e.jsx("form",{style:{height:"10%"},onSubmit:q,children:e.jsxs(z,{direction:"row",height:"100%",padding:"1rem",alignItems:"center",position:"relative",children:[e.jsx($,{sx:{position:"absolute",left:"1.5rem",rotate:"30deg"},onClick:W,children:e.jsx(Fe,{})}),e.jsx(je,{placeholder:"Type Message Here...",value:u,onChange:Q}),e.jsx($,{type:"submit",sx:{rotate:"-30deg",bgcolor:ye,color:"white",marginLeft:"1rem",padding:"0.5rem","&:hover":{bgcolor:"#009900"}},children:e.jsx(we,{})})]})}),e.jsx(_e,{anchorE1:E,chatId:t})]})}const ss=Me()(De);export{ss as default};
